# Reuse existing password or generate new one if none exists
{{- $password := randAlphaNum 64 | b64enc }}
{{- $existing := (lookup "v1" "Secret" .Release.Namespace "sprout-database-secret") }}
{{- if $existing }}
  {{- $password = $existing.data.password }}
{{- end }}
apiVersion: v1
kind: Secret
metadata:
  name: sprout-database-secret
  namespace: {{ .Release.Namespace }}
data:
  password: {{ $password }}
---
apiVersion: v1
kind: Secret
metadata:
  name: sprout-backend-secret
  namespace: {{ .Release.Namespace }}
data:
  DB_PASSWORD: {{ $password }}
